# 規格說明書 (Specification) - Kalimba 17音模擬器

## 1. 專案概述 (Project Overview)
本專案旨在開發一個輕量級、單一檔案的網頁版 17 音 Kalimba（拇指琴）模擬器。目標是提供逼真的彈奏體驗，支援手機觸控與電腦滑鼠操作，並透過程式即時合成音效，無需依賴外部音訊檔案。

## 2. 需求範圍 (Scope)
*   **核心功能**：
    *   模擬 17 音 C 調 Kalimba 的琴鍵排列與音高。
    *   即時音頻合成 (Real-time Audio Synthesis)。
    *   支援多點觸控 (Multi-touch) 與滑鼠點擊。
*   **排除範圍**：
    *   不包含琴譜顯示功能。
    *   不包含錄音功能。
    *   不依賴任何外部圖片或音檔資源。

## 3. 系統限制 (Constraints)
*   **交付格式**：必須為單一 HTML 檔案 (`.html`)，內含所有 CSS 與 JavaScript。
*   **技術棧**：HTML5, CSS3, JavaScript (ES6+)。
*   **相容性**：需支援現代瀏覽器 (Chrome, Safari, Edge) 及行動裝置 (iOS, Android)。

## 4. 詳細規格 (Detailed Specifications)

### 4.1 使用者介面 (UI/UX)
*   **琴身設計**：
    *   採用木紋質感背景 (CSS Gradients)。
    *   包含枕木 (Bridge) 與金屬條 (Z-bar) 的視覺模擬。
    *   中央設有圓形音孔，並帶有「笑臉」裝飾 (CSS Pseudo-elements)。
*   **琴鍵排列**：
    *   標準 17 音 V 型排列。
    *   中央 C4 音鍵最長，向兩側依音高遞增而長度遞減。
    *   **佈局優化**：考量手機瀏覽器底部工具列/網址列遮擋問題，琴鍵整體高度向上收縮，最長琴鍵約佔據畫面 53% 高度。
*   **音名標示**：
    *   採用簡譜 (Jianpu) 系統。
    *   數字表示音階 (1, 2, 3, 4, 5, 6, 7)。
    *   點號表示八度 (無點=中音, 1點=高音, 2點=倍高音)。
    *   點號位於數字上方。
*   **互動回饋**：
    *   按下琴鍵時有下沉位移與亮度變化效果。
    *   支援手機端震動回饋 (若裝置支援)。

### 4.2 音訊引擎 (Audio Engine)
*   **技術**：Web Audio API。
*   **波形**：正弦波 (Sine Wave) 模擬金屬撥片聲。
*   **包絡控制 (ADSR Envelope)**：
    *   為避免高音破音與刺耳感，採用優化後的 Gain 曲線。
    *   Attack: 極短時間內線性上升至 0.3 (降低最大音量以防失真)。
    *   Decay/Sustain: 0.1秒內快速衰減至 0.15。
    *   Release: 2.5秒內指數衰減至靜音。
*   **音頻上下文**：包含使用者互動後的 `ctx.resume()` 機制，以符合瀏覽器自動播放策略。

### 4.3 音階配置 (Key Configuration)
從左至右排列如下：
1.  **D6** (2˙˙) - 1174.66 Hz
2.  **B5** (7˙) - 987.77 Hz
3.  **G5** (5˙) - 783.99 Hz
4.  **E5** (3˙) - 659.25 Hz
5.  **C5** (1˙) - 523.25 Hz
6.  **A4** (6) - 440.00 Hz
7.  **F4** (4) - 349.23 Hz
8.  **D4** (2) - 293.66 Hz
9.  **C4** (1) - 261.63 Hz (中央基準音)
10. **E4** (3) - 329.63 Hz
11. **G4** (5) - 392.00 Hz
12. **B4** (7) - 493.88 Hz
13. **D5** (2˙) - 587.33 Hz
14. **F5** (4˙) - 698.46 Hz
15. **A5** (6˙) - 880.00 Hz
16. **C6** (1˙˙) - 1046.50 Hz
17. **E6** (3˙˙) - 1318.51 Hz

## 5. 檔案結構
*   `kalimba.html`: 包含所有邏輯的唯一交付檔案。
